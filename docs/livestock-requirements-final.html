<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>畜牧管理模块需求文档（最终版）</title>
  <style>
    body { font-family: "PingFang SC", "Microsoft YaHei", sans-serif; line-height: 1.6; font-size: 12pt; }
    h1 { font-size: 22pt; margin: 16px 0; }
    h2 { font-size: 16pt; margin: 14px 0 8px; }
    ol { margin-top: 6px; }
  </style>
</head>
<body>
  <h1>畜牧管理模块需求文档（最终版）</h1>

  <h2>1. 建设范围</h2>
  <ol>
    <li>仅支持 Web 端。</li>
    <li>不包含移动端能力。</li>
    <li>不包含任何审核流程（无待审核、审核通过/驳回、审核日志）。</li>
  </ol>

  <h2>2. 菜单与模块</h2>
  <ol>
    <li>畜牧登记管理（录入+查询一体化）。</li>
    <li>畜牧统计看板（单农场视角）。</li>
  </ol>

  <h2>3. 角色与权限</h2>
  <ol>
    <li>农场用户：仅可查看和操作本农场数据。</li>
    <li>平台管理员：可查看和操作所有农场数据，可切换农场。</li>
    <li>数据权限以 farm_id 为边界，后端强制过滤，越权返回 403。</li>
  </ol>

  <h2>4. 模块一：畜牧登记管理</h2>

  <h2>4.1 页面形态</h2>
  <ol>
    <li>同一页面完成筛选查询、列表展示、新增编辑（抽屉/弹窗）。</li>
    <li>支持详情查看、删除、批量操作（改状态/导出）。</li>
  </ol>

  <h2>4.2 字段要求</h2>
  <ol>
    <li>必填字段：畜种名称、出生日期、防疫状态、近期防疫注射时间、项圈编号。</li>
    <li>选填字段：性别、圈舍、备注。</li>
    <li>支持附件图片上传（多图）。</li>
  </ol>

  <h2>4.3 校验规则</h2>
  <ol>
    <li>出生日期不得晚于当前日期。</li>
    <li>近期防疫注射时间不得晚于当前日期。</li>
    <li>防疫状态与近期防疫注射时间需一致性校验。</li>
    <li>项圈编号唯一（至少农场内唯一，建议可配置）。</li>
  </ol>

  <h2>4.4 列表与操作</h2>
  <ol>
    <li>查询条件：畜种名称、项圈编号、防疫状态、登记时间区间。</li>
    <li>列表字段建议：牲畜编号、畜种名称、出生日期、防疫状态、近期防疫注射时间、项圈编号、性别、圈舍、更新时间。</li>
    <li>状态仅保留：存栏、出栏、死亡。</li>
    <li>删除采用软删除。</li>
  </ol>

  <h2>5. 模块二：畜牧统计看板（统一用饼图）</h2>

  <h2>5.1 存栏（饼图）</h2>
  <ol>
    <li>仅展示三类：存栏、出栏、死亡。</li>
    <li>口径：按当前状态统计数量。</li>
  </ol>

  <h2>5.2 结构分布（饼图）</h2>
  <ol>
    <li>仅展示畜种分布。</li>
    <li>口径：按畜种统计数量。</li>
  </ol>

  <h2>5.3 防疫（饼图）</h2>
  <ol>
    <li>仅展示三类：已接种、未接种、已过期。</li>
    <li>口径：已接种（有有效防疫记录）、未接种（无防疫记录）、已过期（防疫有效期早于当前日期）。</li>
  </ol>

  <h2>5.4 预警（提示列表）</h2>
  <ol>
    <li>7天内即将过期：输出牲畜编号。</li>
    <li>已过期：输出牲畜编号。</li>
    <li>7天内死亡数量超过阈值的畜种：输出畜种、近7天死亡数、阈值。</li>
    <li>阈值支持配置（默认值可设为 5）。</li>
  </ol>

  <h2>6. 附件上传要求</h2>
  <ol>
    <li>支持 jpg/jpeg/png/webp。</li>
    <li>支持多图上传。</li>
    <li>单张大小限制可配置（建议默认 10MB）。</li>
  </ol>

  <h2>7. 验收标准</h2>
  <ol>
    <li>农场用户无法查看其他农场数据。</li>
    <li>畜牧登记页面可完成录入、查询、编辑、删除、附件上传。</li>
    <li>统计看板四个模块全部按单农场口径展示，且均为饼图（预警为列表）。</li>
    <li>预警可正确输出即将过期/已过期牲畜编号及超阈值畜种。</li>
  </ol>
</body>
</html>
